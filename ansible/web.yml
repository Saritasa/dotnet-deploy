- hosts: webservers
  roles:
    - aspnetcore
  vars:
    site_root: '/var/www/{{site_name}}'
  tasks:
    - name: Create Systemd service
      copy:
        content: |
          [Unit]
          Description=DeployDemo.Web ASP.NET Core site

          [Service]
          WorkingDirectory={{site_root}}
          ExecStart=/usr/bin/dotnet {{site_root}}/DeployDemo.Web.dll
          Restart=always
          # Restart service after 10 seconds if the dotnet service crashes:
          RestartSec=10
          SyslogIdentifier={{service_name}}
          User={{deploy_username}}

          [Install]
          WantedBy=multi-user.target
        dest: '/etc/systemd/system/{{service_name}}.service'
      become: yes

    - name: Start dotnet service
      service:
        name: deploy-demo
        state: started
      become: yes
